'use client';

import React, { useState } from 'react';

// ===========================
// TYPE DEFINITIONS
// ===========================

type Role = 'technician' | 'cs' | 'leader' | 'admin' | 'noc' | 'dispatcher' | 'warehouse' | 'management';

type TaskType = 'installation' | 'repair' | 'decommission' | 'network';
type TaskStatus = 'assigned' | 'in-progress' | 'completed';
type Priority = 'urgent' | 'high' | 'normal';

interface Task {
  id: string;
  type: TaskType;
  title: string;
  customer: {
    name: string;
    address: string;
    phone: string;
    package?: string;
  };
  priority: Priority;
  status: TaskStatus;
  scheduledDate: string;
  description: string;
}

interface InventoryItem {
  id: string;
  name: string;
  quantity: number;
  unit: string;
  lastUsed?: string;
}

interface Message {
  id: string;
  sender: string;
  text: string;
  timestamp: string;
  isOwn: boolean;
}

// ===========================
// MOCK DATA
// ===========================

const mockTasks: Task[] = [
  {
    id: '1',
    type: 'installation',
    title: 'Instalasi - Anton Wijaya',
    customer: {
      name: 'Anton Wijaya',
      address: 'Jl. Merdeka No. 123, Jakarta Selatan',
      phone: '081234567890',
      package: 'Internet 100 Mbps'
    },
    priority: 'urgent',
    status: 'assigned',
    scheduledDate: '2024-01-15',
    description: 'Instalasi baru pelanggan residensial'
  },
  {
    id: '2',
    type: 'repair',
    title: 'Perbaikan - Budi Santoso',
    customer: {
      name: 'Budi Santoso',
      address: 'Jl. Sudirman No. 45, Jakarta Pusat',
      phone: '081298765432'
    },
    priority: 'high',
    status: 'assigned',
    scheduledDate: '2024-01-15',
    description: 'Internet mati total sejak pagi'
  },
  {
    id: '3',
    type: 'decommission',
    title: 'Pencabutan - Siti Rahayu',
    customer: {
      name: 'Siti Rahayu',
      address: 'Jl. Gatot Subroto No. 88, Jakarta Selatan',
      phone: '081334455667'
    },
    priority: 'normal',
    status: 'assigned',
    scheduledDate: '2024-01-16',
    description: 'Pelanggan berhenti berlangganan'
  }
];

const mockInventory: InventoryItem[] = [
  { id: '1', name: 'ONT ZTE F670L', quantity: 12, unit: 'unit', lastUsed: '2024-01-14' },
  { id: '2', name: 'Kabel Dropcore', quantity: 450, unit: 'meter', lastUsed: '2024-01-13' },
  { id: '3', name: 'Konektor SC/APC', quantity: 28, unit: 'pcs', lastUsed: '2024-01-14' },
  { id: '4', name: 'Patchcord 3M', quantity: 15, unit: 'pcs', lastUsed: '2024-01-12' }
];

const mockMessages: Message[] = [
  { id: '1', sender: 'Dispatcher', text: 'Ada tugas urgent di area Blok C, bisa ambil?', timestamp: '09:15', isOwn: false },
  { id: '2', sender: 'You', text: 'Siap, saya sudah selesai tugas sebelumnya', timestamp: '09:17', isOwn: true },
  { id: '3', sender: 'NOC Team', text: 'ODP-B-01 penuh, gunakan ODP-B-02 port 3', timestamp: '10:30', isOwn: false }
];

const knowledgeBaseArticles = [
  { id: '1', title: 'Panduan Instalasi ONT ZTE F670L', category: 'Instalasi', views: 245 },
  { id: '2', title: 'Troubleshooting Signal Loss', category: 'Perbaikan', views: 189 },
  { id: '3', title: 'SOP Pencabutan Aset', category: 'Pencabutan', views: 156 },
  { id: '4', title: 'Cara Mengukur Redaman dengan OPM', category: 'Survey', views: 312 }
];

// ===========================
// UI COMPONENTS
// ===========================

const Button: React.FC<{
  children: React.ReactNode;
  variant?: 'primary' | 'secondary' | 'danger' | 'success';
  size?: 'sm' | 'md' | 'lg';
  onClick?: () => void;
  fullWidth?: boolean;
  disabled?: boolean;
}> = ({ children, variant = 'primary', size = 'md', onClick, fullWidth, disabled }) => {
  const baseClasses = 'font-medium rounded-xl transition-all duration-200 shadow-md hover:shadow-lg active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed';
  
  const variantClasses = {
    primary: 'bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white',
    secondary: 'bg-gray-200 hover:bg-gray-300 text-gray-800',
    danger: 'bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white',
    success: 'bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white'
  };

  const sizeClasses = {
    sm: 'px-3 py-1.5 text-sm',
    md: 'px-4 py-2 text-base',
    lg: 'px-6 py-3 text-lg'
  };

  return (
    <button
      onClick={onClick}
      disabled={disabled}
      className={`${baseClasses} ${variantClasses[variant]} ${sizeClasses[size]} ${fullWidth ? 'w-full' : ''}`}
    >
      {children}
    </button>
  );
};

const Card: React.FC<{
  children: React.ReactNode;
  title?: string;
  className?: string;
}> = ({ children, title, className = '' }) => (
  <div className={`bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden ${className}`}>
    {title && (
      <div className="px-6 py-4 bg-gradient-to-r from-gray-50 to-white border-b border-gray-100">
        <h3 className="text-lg font-semibold text-gray-800">{title}</h3>
      </div>
    )}
    <div className="p-6">{children}</div>
  </div>
);

const Badge: React.FC<{
  children: React.ReactNode;
  variant?: 'success' | 'warning' | 'danger' | 'info' | 'default';
}> = ({ children, variant = 'default' }) => {
  const variantClasses = {
    success: 'bg-green-100 text-green-800 border-green-200',
    warning: 'bg-yellow-100 text-yellow-800 border-yellow-200',
    danger: 'bg-red-100 text-red-800 border-red-200',
    info: 'bg-blue-100 text-blue-800 border-blue-200',
    default: 'bg-gray-100 text-gray-800 border-gray-200'
  };

  return (
    <span className={`inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold border ${variantClasses[variant]}`}>
      {children}
    </span>
  );
};

const Input: React.FC<{
  label?: string;
  type?: string;
  placeholder?: string;
  value?: string;
  onChange?: (e: React.ChangeEvent<HTMLInputElement>) => void;
  error?: string;
}> = ({ label, type = 'text', placeholder, value, onChange, error }) => (
  <div className="space-y-2">
    {label && <label className="block text-sm font-medium text-gray-700">{label}</label>}
    <input
      type={type}
      placeholder={placeholder}
      value={value}
      onChange={onChange}
      className={`w-full px-4 py-2.5 rounded-xl border ${
        error ? 'border-red-300 focus:ring-red-500' : 'border-gray-200 focus:ring-blue-500'
      } focus:outline-none focus:ring-2 transition-all duration-200`}
    />
    {error && <p className="text-sm text-red-600">{error}</p>}
  </div>
);

const Tabs: React.FC<{
  tabs: string[];
  activeTab: number;
  onChange: (index: number) => void;
}> = ({ tabs, activeTab, onChange }) => (
  <div className="flex space-x-1 bg-gray-100 p-1 rounded-xl">
    {tabs.map((tab, index) => (
      <button
        key={index}
        onClick={() => onChange(index)}
        className={`flex-1 px-4 py-2.5 rounded-lg font-medium text-sm transition-all duration-200 ${
          activeTab === index
            ? 'bg-white text-blue-600 shadow-md'
            : 'text-gray-600 hover:text-gray-800'
        }`}
      >
        {tab}
      </button>
    ))}
  </div>
);

// ===========================
// LAYOUT COMPONENTS
// ===========================

const Sidebar: React.FC<{
  isOpen: boolean;
  currentRole: Role;
  currentPage: string;
  onNavigate: (page: string) => void;
}> = ({ isOpen, currentRole, currentPage, onNavigate }) => {
  const menuItems: Record<Role, { icon: string; label: string; page: string }[]> = {
    technician: [
      { icon: 'ğŸ“Š', label: 'Dashboard', page: 'dashboard' },
      { icon: 'ğŸ“‹', label: 'Tugas Saya', page: 'tasks' },
      { icon: 'ğŸ“¦', label: 'Inventaris', page: 'inventory' },
      { icon: 'ğŸ’¬', label: 'Chat Internal', page: 'chat' },
      { icon: 'ğŸ“š', label: 'SOP & Panduan', page: 'knowledge' }
    ],
    cs: [
      { icon: 'ğŸ“Š', label: 'Dashboard', page: 'dashboard' },
      { icon: 'ğŸ«', label: 'Tiket Pelanggan', page: 'tickets' },
      { icon: 'ğŸ‘¥', label: 'Database Pelanggan', page: 'customers' },
      { icon: 'ğŸ“ˆ', label: 'Laporan', page: 'reports' },
      { icon: 'ğŸ“š', label: 'Knowledge Base', page: 'knowledge' }
    ],
    leader: [
      { icon: 'ğŸ“Š', label: 'Dashboard', page: 'dashboard' },
      { icon: 'ğŸ‘¨â€ğŸ’¼', label: 'Tim Teknisi', page: 'team' },
      { icon: 'ğŸ“‹', label: 'Assign Tugas', page: 'assign-tasks' },
      { icon: 'âœ…', label: 'Approval BAI', page: 'approvals' },
      { icon: 'ğŸ“ˆ', label: 'KPI Tim', page: 'kpi' }
    ],
    dispatcher: [
      { icon: 'ğŸ“Š', label: 'Dashboard', page: 'dashboard' },
      { icon: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/c4654b6d-214c-45b0-aa9c-64577cfca857.png', label: 'Peta Real-time', page: 'live-map' },
      { icon: 'ğŸ“‹', label: 'Assign Tugas', page: 'assign-tasks' },
      { icon: 'ğŸ“…', label: 'Jadwal Shift', page: 'schedules' },
      { icon: 'ğŸ“ˆ', label: 'Performa Tim', page: 'performance' }
    ],
    noc: [
      { icon: 'ğŸ“Š', label: 'Dashboard', page: 'dashboard' },
      { icon: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/107a4a78-7090-484a-8a20-fbe4f1a14777.png', label: 'Monitoring Jaringan', page: 'network-monitor' },
      { icon: 'ğŸš¨', label: 'Alarm & Alert', page: 'alarms' },
      { icon: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/3c6567ad-ab76-4e3a-bda7-4685816017c2.png', label: 'Topologi Jaringan', page: 'topology' },
      { icon: 'ğŸ”§', label: 'Remote Diagnostic', page: 'diagnostics' }
    ],
    warehouse: [
      { icon: 'ğŸ“Š', label: 'Dashboard', page: 'dashboard' },
      { icon: 'ğŸ“¦', label: 'Stok Gudang', page: 'warehouse-stock' },
      { icon: 'ğŸ“¥', label: 'Request Material', page: 'requests' },
      { icon: 'ğŸ“Š', label: 'Laporan Penggunaan', page: 'usage-reports' },
      { icon: 'ğŸ·ï¸', label: 'Tracking Aset', page: 'asset-tracking' }
    ],
    admin: [
      { icon: 'ğŸ“Š', label: 'Dashboard', page: 'dashboard' },
      { icon: 'ğŸ“‹', label: 'Semua Tugas', page: 'tasks' },
      { icon: 'ğŸ“¦', label: 'Inventaris Global', page: 'inventory' },
      { icon: 'ğŸ’¬', label: 'Chat Internal', page: 'chat' },
      { icon: 'ğŸ“š', label: 'Knowledge Base', page: 'knowledge' },
      { icon: 'ğŸ‘¥', label: 'Daftar User', page: 'users' },
      { icon: 'ğŸ”', label: 'Role & Permission', page: 'roles' },
      { icon: 'âš™ï¸', label: 'Pengaturan API', page: 'api-settings' },
      { icon: 'ğŸ“', label: 'System Logs', page: 'logs' }
    ],
    management: [
      { icon: 'ğŸ“Š', label: 'Executive Dashboard', page: 'dashboard' },
      { icon: 'ğŸ“ˆ', label: 'Laporan Komprehensif', page: 'comprehensive-reports' },
      { icon: 'ğŸ“‰', label: 'Analitik Trend', page: 'analytics' },
      { icon: 'ğŸ’¾', label: 'Export Report', page: 'exports' }
    ]
  };

  return (
    <aside
      className={`fixed top-0 left-0 h-full bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-white transition-all duration-300 z-40 ${
        isOpen ? 'w-64' : 'w-0 -translate-x-full'
      } md:translate-x-0 md:w-64 shadow-2xl`}
    >
      <div className="p-6 border-b border-gray-700">
        <div className="flex items-center space-x-3">
          <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-emerald-500 flex items-center justify-center font-bold text-lg">
            F
          </div>
          <div>
            <h2 className="font-bold text-lg">FieldTech Pro</h2>
            <p className="text-xs text-gray-400 capitalize">{currentRole} Portal</p>
          </div>
        </div>
      </div>

      <nav className="p-4 space-y-2 overflow-y-auto h-[calc(100vh-120px)]">
        {menuItems[currentRole].map((item) => (
          <button
            key={item.page}
            onClick={() => onNavigate(item.page)}
            className={`w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200 ${
              currentPage === item.page
                ? 'bg-gradient-to-r from-blue-600 to-blue-700 shadow-lg'
                : 'hover:bg-gray-700/50'
            }`}
          >
            <span className="text-xl">{item.icon}</span>
            <span className="font-medium">{item.label}</span>
          </button>
        ))}
      </nav>
    </aside>
  );
};

const Header: React.FC<{
  onToggleSidebar: () => void;
  currentRole: Role;
  userName: string;
}> = ({ onToggleSidebar, currentRole, userName }) => (
  <header className="sticky top-0 z-30 bg-white/95 backdrop-blur-md border-b border-gray-200 shadow-sm">
    <div className="flex items-center justify-between px-4 py-3 md:px-6">
      <div className="flex items-center space-x-4">
        <button
          onClick={onToggleSidebar}
          className="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors"
        >
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
        <div>
          <h1 className="text-xl font-bold text-gray-800">Field Technician System</h1>
          <p className="text-sm text-gray-500 capitalize">{currentRole} Dashboard</p>
        </div>
      </div>

      <div className="flex items-center space-x-4">
        <button className="relative p-2 rounded-lg hover:bg-gray-100 transition-colors">
          <svg className="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
          </svg>
          <span className="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
        </button>

        <div className="flex items-center space-x-3 px-3 py-2 bg-gray-50 rounded-xl">
          <div className="w-9 h-9 rounded-full bg-gradient-to-br from-blue-500 to-emerald-500 flex items-center justify-center font-bold text-white text-sm">
            {userName.charAt(0).toUpperCase()}
          </div>
          <div className="hidden md:block">
            <p className="text-sm font-semibold text-gray-800">{userName}</p>
            <p className="text-xs text-gray-500 capitalize">{currentRole}</p>
          </div>
        </div>
      </div>
    </div>
  </header>
);

// ===========================
// PAGE COMPONENTS
// ===========================

const DashboardPage: React.FC<{ currentRole: Role; onNavigate: (page: string) => void }> = ({ currentRole, onNavigate }) => (
  <div className="space-y-6">
    <div className="flex items-center justify-between">
      <div>
        <h2 className="text-3xl font-bold text-gray-800">Dashboard</h2>
        <p className="text-gray-600 mt-1">Selamat datang kembali! Berikut ringkasan hari ini.</p>
      </div>
      {currentRole === 'technician' && (
        <Button variant="success" size="lg">
          <span className="flex items-center space-x-2">
            <span>âœ“</span>
            <span>Clock-in</span>
          </span>
        </Button>
      )}
    </div>

    {(currentRole === 'technician' || currentRole === 'admin') && (
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <Card className="bg-gradient-to-br from-blue-500 to-blue-600 text-white">
          <div className="space-y-2">
            <p className="text-blue-100 text-sm font-medium">Tugas Baru</p>
            <p className="text-4xl font-bold">3</p>
            <p className="text-blue-100 text-xs">Belum dikerjakan</p>
          </div>
        </Card>

        <Card className="bg-gradient-to-br from-yellow-500 to-yellow-600 text-white">
          <div className="space-y-2">
            <p className="text-yellow-100 text-sm font-medium">Sedang Dikerjakan</p>
            <p className="text-4xl font-bold">2</p>
            <p className="text-yellow-100 text-xs">In Progress</p>
          </div>
        </Card>

        <Card className="bg-gradient-to-br from-green-500 to-green-600 text-white">
          <div className="space-y-2">
            <p className="text-green-100 text-sm font-medium">Selesai Hari Ini</p>
            <p className="text-4xl font-bold">5</p>
            <p className="text-green-100 text-xs">Completed</p>
          </div>
        </Card>
      </div>
    )}

    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <Card title="Peta Lokasi Tugas">
        <div className="h-64 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl flex items-center justify-center">
          <div className="text-center">
            <div className="text-6xl mb-4">ğŸ—ºï¸</div>
            <p className="text-gray-600 font-medium">Map View</p>
            <p className="text-gray-500 text-sm">Interactive map showing task locations</p>
          </div>
        </div>
        {(currentRole === 'technician' || currentRole === 'admin') && (
          <div className="mt-4">
            <Button fullWidth onClick={() => onNavigate('tasks')}>
              Lihat Semua Tugas
            </Button>
          </div>
        )}
      </Card>

      {(currentRole === 'technician' || currentRole === 'admin') && (
        <Card title="Status & Aktivitas Terkini">
          <div className="space-y-4">
            <div className="flex items-center justify-between p-4 bg-green-50 rounded-xl border border-green-200">
              <div className="flex items-center space-x-3">
                <div className="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white font-bold">
                  âœ“
                </div>
                <div>
                  <p className="font-semibold text-gray-800">Status Absensi</p>
                  <p className="text-sm text-gray-600">Clock-in: 08:15 WIB</p>
                </div>
              </div>
              <Badge variant="success">Online</Badge>
            </div>

            <div className="space-y-3">
              <div className="flex items-start space-x-3 p-3 bg-gray-50 rounded-xl">
                <span className="text-2xl">ğŸ“¦</span>
                <div className="flex-1">
                  <p className="text-sm font-medium text-gray-800">Material Request Approved</p>
                  <p className="text-xs text-gray-600">10 unit ONT ZTE telah disiapkan di gudang</p>
                  <p className="text-xs text-gray-400 mt-1">15 menit yang lalu</p>
                </div>
              </div>

              <div className="flex items-start space-x-3 p-3 bg-gray-50 rounded-xl">
                <span className="text-2xl">âœ…</span>
                <div className="flex-1">
                  <p className="text-sm font-medium text-gray-800">Tugas Selesai</p>
                  <p className="text-xs text-gray-600">Instalasi - Dewi Lestari telah diselesaikan</p>
                  <p className="text-xs text-gray-400 mt-1">1 jam yang lalu</p>
                </div>
              </div>
            </div>
          </div>
        </Card>
      )}
    </div>
  </div>
);

const TasksPage: React.FC<{ onSelectTask: (taskId: string) => void }> = ({ onSelectTask }) => {
  const [filter, setFilter] = useState('all');
  const [searchTerm, setSearchTerm] = useState('');

  const filteredTasks = mockTasks.filter(task => {
    const matchesFilter = filter === 'all' || task.status === filter;
    const matchesSearch = task.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         task.customer.name.toLowerCase().includes(searchTerm.toLowerCase());
    return matchesFilter && matchesSearch;
  });

  const getPriorityColor = (priority: Priority) => {
    switch (priority) {
      case 'urgent': return 'danger';
      case 'high': return 'warning';
      default: return 'default';
    }
  };

  const getTypeIcon = (type: TaskType) => {
    switch (type) {
      case 'installation': return 'ğŸ”§';
      case 'repair': return 'ğŸ› ï¸';
      case 'decommission': return 'ğŸ“¤';
      case 'network': return 'ğŸŒ';
    }
  };

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-3xl font-bold text-gray-800">Daftar Tugas</h2>
        <p className="text-gray-600 mt-1">Kelola dan monitor semua work order Anda</p>
      </div>

      <Card>
        <div className="space-y-4">
          <div className="flex flex-col md:flex-row gap-4">
            <div className="flex-1">
              <Input
                placeholder="Cari tugas atau nama pelanggan..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
              />
            </div>
            <select
              value={filter}
              onChange={(e) => setFilter(e.target.value)}
              className="px-4 py-2.5 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="all">Semua Status</option>
              <option value="assigned">Assigned</option>
              <option value="in-progress">In Progress</option>
              <option value="completed">Completed</option>
            </select>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {filteredTasks.map(task => (
              <div
                key={task.id}
                className="p-5 bg-white border-2 border-gray-100 rounded-2xl hover:border-blue-300 hover:shadow-xl transition-all duration-200 cursor-pointer"
                onClick={() => onSelectTask(task.id)}
              >
                <div className="flex items-start justify-between mb-3">
                  <div className="flex items-center space-x-2">
                    <span className="text-2xl">{getTypeIcon(task.type)}</span>
                    <Badge variant={getPriorityColor(task.priority)}>
                      {task.priority.toUpperCase()}
                    </Badge>
                  </div>
                  <Badge variant="info">{task.status}</Badge>
                </div>

                <h3 className="font-bold text-gray-800 text-lg mb-2">{task.title}</h3>
                
                <div className="space-y-2 text-sm text-gray-600">
                  <div className="flex items-center space-x-2">
                    <span>ğŸ‘¤</span>
                    <span>{task.customer.name}</span>
                  </div>
                  <div className="flex items-start space-x-2">
                    <span>ğŸ“</span>
                    <span className="flex-1">{task.customer.address}</span>
                  </div>
                  <div className="flex items-center space-x-2">
                    <span>ğŸ“…</span>
                    <span>{task.scheduledDate}</span>
                  </div>
                </div>

                <div className="mt-4 pt-4 border-t border-gray-100">
                  <Button fullWidth>Mulai Tugas</Button>
                </div>
              </div>
            ))}
          </div>

          {filteredTasks.length === 0 && (
            <div className="text-center py-12">
              <p className="text-gray-500 text-lg">Tidak ada tugas yang ditemukan</p>
            </div>
          )}
        </div>
      </Card>
    </div>
  );
};

const TaskDetailPage: React.FC<{ taskId: string; onBack: () => void }> = ({ taskId, onBack }) => {
  const [activeTab, setActiveTab] = useState(0);
  const [signalODP, setSignalODP] = useState('');
  const [signalRoset, setSignalRoset] = useState('');
  const [serialNumber, setSN] = useState('');
  const [showSuccess, setShowSuccess] = useState(false);

  const task = mockTasks.find(t => t.id === taskId);
  if (!task) return null;

  const validateSignal = (value: string) => {
    const num = parseFloat(value);
    if (isNaN(num)) return null;
    if (num > -25) return 'success';
    if (num > -28) return 'warning';
    return 'danger';
  };

  const odpStatus = validateSignal(signalODP);
  const rosetStatus = validateSignal(signalRoset);

  const handleActivation = () => {
    if (!serialNumber) {
      alert('Silakan scan barcode ONT terlebih dahulu');
      return;
    }
    setShowSuccess(true);
    setTimeout(() => setShowSuccess(false), 3000);
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center space-x-4">
        <button
          onClick={onBack}
          className="p-2 rounded-lg hover:bg-gray-100 transition-colors"
        >
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
          </svg>
        </button>
        <div>
          <h2 className="text-3xl font-bold text-gray-800">{task.title}</h2>
          <p className="text-gray-600 mt-1">Detail Work Order #{task.id}</p>
        </div>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div className="lg:col-span-1">
          <Card title="Informasi Pelanggan">
            <div className="space-y-4">
              <div>
                <p className="text-sm text-gray-600 mb-1">Nama</p>
                <p className="font-semibold text-gray-800">{task.customer.name}</p>
              </div>
              <div>
                <p className="text-sm text-gray-600 mb-1">Alamat</p>
                <p className="font-medium text-gray-800">{task.customer.address}</p>
              </div>
              <div>
                <p className="text-sm text-gray-600 mb-1">No. Telepon</p>
                <p className="font-medium text-gray-800">{task.customer.phone}</p>
              </div>
              {task.customer.package && (
                <div>
                  <p className="text-sm text-gray-600 mb-1">Paket Layanan</p>
                  <Badge variant="info">{task.customer.package}</Badge>
                </div>
              )}
              <div className="pt-4 border-t">
                <Button fullWidth variant="secondary">
                  <span className="flex items-center justify-center space-x-2">
                    <span>ğŸ—ºï¸</span>
                    <span>Navigasi ke Lokasi</span>
                  </span>
                </Button>
              </div>
            </div>
          </Card>
        </div>

        <div className="lg:col-span-2">
          <Card>
            <Tabs
              tabs={['Info', 'Survey Jaringan', 'Aktivasi', 'Dokumentasi']}
              activeTab={activeTab}
              onChange={setActiveTab}
            />

            <div className="mt-6">
              {activeTab === 0 && (
                <div className="space-y-6">
                  <div className="p-5 bg-blue-50 border border-blue-200 rounded-xl">
                    <h4 className="font-semibold text-blue-900 mb-2">Deskripsi Tugas</h4>
                    <p className="text-blue-800">{task.description}</p>
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div className="p-4 bg-gray-50 rounded-xl">
                      <p className="text-sm text-gray-600 mb-1">Tipe Tugas</p>
                      <p className="font-semibold text-gray-800 capitalize">{task.type}</p>
                    </div>
                    <div className="p-4 bg-gray-50 rounded-xl">
                      <p className="text-sm text-gray-600 mb-1">Prioritas</p>
                      <Badge variant={task.priority === 'urgent' ? 'danger' : task.priority === 'high' ? 'warning' : 'default'}>
                        {task.priority.toUpperCase()}
                      </Badge>
                    </div>
                    <div className="p-4 bg-gray-50 rounded-xl">
                      <p className="text-sm text-gray-600 mb-1">Status</p>
                      <Badge variant="info">{task.status}</Badge>
                    </div>
                    <div className="p-4 bg-gray-50 rounded-xl">
                      <p className="text-sm text-gray-600 mb-1">Tanggal</p>
                      <p className="font-semibold text-gray-800">{task.scheduledDate}</p>
                    </div>
                  </div>

                  <div className="pt-4">
                    <Button fullWidth size="lg">
                      Tiba di Lokasi / Mulai Tugas
                    </Button>
                  </div>
                </div>
              )}

              {activeTab === 1 && (
                <div className="space-y-6">
                  <div className="h-64 bg-gradient-to-br from-emerald-100 to-blue-100 rounded-xl flex items-center justify-center">
                    <div className="text-center">
                      <div className="text-6xl mb-4">ğŸ—ºï¸</div>
                      <p className="text-gray-700 font-medium">Peta Jaringan ODP</p>
                      <p className="text-gray-600 text-sm">Menampilkan ODP terdekat dengan status port</p>
                    </div>
                  </div>

                  <Card title="Hasil Pengukuran Redaman">
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Redaman di ODP (dB)
                        </label>
                        <input
                          type="number"
                          placeholder="-19"
                          value={signalODP}
                          onChange={(e) => setSignalODP(e.target.value)}
                          className="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                        {odpStatus && (
                          <div className={`mt-2 p-3 rounded-lg ${
                            odpStatus === 'success' ? 'bg-green-50 text-green-800' :
                            odpStatus === 'warning' ? 'bg-yellow-50 text-yellow-800' :
                            'bg-red-50 text-red-800'
                          }`}>
                            {odpStatus === 'success' ? 'âœ“ Redaman normal' :
                             odpStatus === 'warning' ? 'âš  Redaman cukup tinggi' :
                             'âœ— Redaman terlalu tinggi! Periksa kabel'}
                          </div>
                        )}
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Redaman di Roset Pelanggan (dB)
                        </label>
                        <input
                          type="number"
                          placeholder="-21"
                          value={signalRoset}
                          onChange={(e) => setSignalRoset(e.target.value)}
                          className="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                        {rosetStatus && (
                          <div className={`mt-2 p-3 rounded-lg ${
                            rosetStatus === 'success' ? 'bg-green-50 text-green-800' :
                            rosetStatus === 'warning' ? 'bg-yellow-50 text-yellow-800' :
                            'bg-red-50 text-red-800'
                          }`}>
                            {rosetStatus === 'success' ? 'âœ“ Redaman normal' :
                             rosetStatus === 'warning' ? 'âš  Redaman cukup tinggi' :
                             'âœ— Redaman terlalu tinggi! Periksa konektor'}
                          </div>
                        )}
                      </div>

                      <Button fullWidth>Simpan Hasil Survey</Button>
                    </div>
                  </Card>
                </div>
              )}

              {activeTab === 2 && (
                <div className="space-y-6">
                  <Card title="Scan Perangkat ONT">
                    <div className="space-y-4">
                      <div className="h-48 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl flex items-center justify-center border-2 border-dashed border-gray-300">
                        <div className="text-center">
                          <div className="text-6xl mb-3">https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/c5d78771-a7fc-47f1-9dad-a045f36bf9d3.png</div>
                          <p className="text-gray-600 font-medium">Kamera Barcode Scanner</p>
                          <p className="text-gray-500 text-sm">Arahkan ke barcode Serial Number ONT</p>
                        </div>
                      </div>

                      <Input
                        label="Serial Number ONT"
                        placeholder="ZTEG12345678"
                        value={serialNumber}
                        onChange={(e) => setSN(e.target.value)}
                      />

                      <Button
                        fullWidth
                        size="lg"
                        onClick={handleActivation}
                        disabled={!serialNumber}
                      >
                        Aktifkan Layanan
                      </Button>

                      {showSuccess && (
                        <div className="p-4 bg-green-50 border border-green-200 rounded-xl animate-pulse">
                          <div className="flex items-center space-x-3">
                            <span className="text-3xl">âœ“</span>
                            <div>
                              <p className="font-semibold text-green-900">Aktivasi Berhasil!</p>
                              <p className="text-sm text-green-800">Perangkat telah terdaftar di sistem provisioning</p>
                            </div>
                          </div>
                        </div>
                      )}
                    </div>
                  </Card>

                  <Card title="Status Provisioning">
                    <div className="space-y-3">
                      <div className="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                        <span className="text-sm font-medium text-green-900">Registrasi MAC ke OLT</span>
                        <span className="text-green-600 font-bold">âœ“</span>
                      </div>
                      <div className="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                        <span className="text-sm font-medium text-green-900">Konfigurasi VLAN</span>
                        <span className="text-green-600 font-bold">âœ“</span>
                      </div>
                      <div className="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                        <span className="text-sm font-medium text-green-900">Aktivasi RADIUS</span>
                        <span className="text-green-600 font-bold">âœ“</span>
                      </div>
                    </div>
                  </Card>
                </div>
              )}

              {activeTab === 3 && (
                <div className="space-y-6">
                  <Card title="Checklist Material">
                    <div className="space-y-2">
                      {[
                        '1x ONT ZTE F670L',
                        '50 meter Kabel Dropcore',
                        '2x Konektor SC/APC',
                        '1x Patchcord 3M'
                      ].map((item, idx) => (
                        <div key={idx} className="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                          <input type="checkbox" className="w-5 h-5 rounded" defaultChecked />
                          <span className="text-sm font-medium text-gray-700">{item}</span>
                        </div>
                      ))}
                    </div>
                  </Card>

                  <Card title="Upload Foto Dokumentasi">
                    <div className="space-y-4">
                      {['Foto Depan Rumah', 'Foto Instalasi Router', 'Foto Hasil Speedtest'].map((label, idx) => (
                        <div key={idx} className="p-4 border-2 border-dashed border-gray-300 rounded-xl hover:border-blue-400 transition-colors cursor-pointer">
                          <div className="flex items-center justify-center space-x-3">
                            <span className="text-2xl">ğŸ“·</span>
                            <span className="text-sm font-medium text-gray-600">{label}</span>
                          </div>
                        </div>
                      ))}
                    </div>
                  </Card>

                  <Card title="Tanda Tangan Digital">
                    <div className="space-y-4">
                      <div className="h-40 bg-gray-50 border-2 border-gray-300 rounded-xl flex items-center justify-center">
                        <p className="text-gray-500">Canvas untuk tanda tangan pelanggan</p>
                      </div>
                      <div className="h-40 bg-gray-50 border-2 border-gray-300 rounded-xl flex items-center justify-center">
                        <p className="text-gray-500">Canvas untuk tanda tangan teknisi</p>
                      </div>
                    </div>
                  </Card>

                  <Button fullWidth variant="success" size="lg">
                    Selesaikan Tugas Instalasi
                  </Button>
                </div>
              )}
            </div>
          </Card>
        </div>
      </div>
    </div>
  );
};

const InventoryPage: React.FC = () => {
  const [showRequest, setShowRequest] = useState(false);

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-3xl font-bold text-gray-800">Inventaris Material</h2>
          <p className="text-gray-600 mt-1">Kelola stok material yang Anda pegang</p>
        </div>
        <Button onClick={() => setShowRequest(!showRequest)}>
          + Request Material
        </Button>
      </div>

      {showRequest && (
        <Card title="Form Request Material">
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Pilih Item</label>
              <select className="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option>ONT ZTE F670L</option>
                <option>Kabel Dropcore</option>
                <option>Konektor SC/APC</option>
                <option>Patchcord 3M</option>
              </select>
            </div>
            <Input label="Jumlah" type="number" placeholder="10" />
            <div className="flex space-x-3">
              <Button fullWidth>Kirim Request</Button>
              <Button fullWidth variant="secondary" onClick={() => setShowRequest(false)}>
                Batal
              </Button>
            </div>
          </div>
        </Card>
      )}

      <Card title="Stok Saat Ini">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="border-b border-gray-200">
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Item</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Jumlah</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Satuan</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Terakhir Digunakan</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
              </tr>
            </thead>
            <tbody>
              {mockInventory.map(item => (
                <tr key={item.id} className="border-b border-gray-100 hover:bg-gray-50">
                  <td className="py-3 px-4 font-medium text-gray-800">{item.name}</td>
                  <td className="py-3 px-4">
                    <span className={`font-bold ${item.quantity < 5 ? 'text-red-600' : 'text-gray-800'}`}>
                      {item.quantity}
                    </span>
                  </td>
                  <td className="py-3 px-4 text-gray-600">{item.unit}</td>
                  <td className="py-3 px-4 text-gray-600 text-sm">{item.lastUsed || '-'}</td>
                  <td className="py-3 px-4">
                    <Badge variant={item.quantity < 5 ? 'danger' : item.quantity < 10 ? 'warning' : 'success'}>
                      {item.quantity < 5 ? 'Stok Rendah' : item.quantity < 10 ? 'Stok Sedang' : 'Stok Aman'}
                    </Badge>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </Card>

      <Card title="Riwayat Penggunaan">
        <div className="space-y-3">
          <div className="flex items-start space-x-3 p-4 bg-gray-50 rounded-xl">
            <span className="text-2xl">ğŸ“¦</span>
            <div className="flex-1">
              <p className="font-medium text-gray-800">-1 ONT ZTE F670L</p>
              <p className="text-sm text-gray-600">Instalasi - Anton Wijaya</p>
              <p className="text-xs text-gray-500 mt-1">14 Jan 2024, 14:30</p>
            </div>
          </div>
          <div className="flex items-start space-x-3 p-4 bg-gray-50 rounded-xl">
            <span className="text-2xl">ğŸ“¦</span>
            <div className="flex-1">
              <p className="font-medium text-gray-800">-2 Konektor SC/APC, -15m Kabel</p>
              <p className="text-sm text-gray-600">Perbaikan - Budi Santoso</p>
              <p className="text-xs text-gray-500 mt-1">13 Jan 2024, 10:15</p>
            </div>
          </div>
        </div>
      </Card>

      <Card title="QR Code untuk Serah Terima Gudang">
        <div className="flex flex-col items-center justify-center p-8">
          <div className="w-48 h-48 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl flex items-center justify-center mb-4">
            <div className="text-center">
              <div className="text-6xl mb-2">https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/92d0b725-3ca9-4323-bfcb-9db6f83df938.png</div>
              <p className="text-gray-600 font-medium">QR Code</p>
            </div>
          </div>
          <p className="text-sm text-gray-600 text-center">
            Tunjukkan QR Code ini ke Admin Gudang saat mengambil material
          </p>
        </div>
      </Card>
    </div>
  );
};

const ChatPage: React.FC = () => {
  const [message, setMessage] = useState('');
  const [selectedContact, setSelectedContact] = useState('Dispatcher');

  const contacts = ['Dispatcher', 'NOC Team', 'Team Leader', 'Warehouse'];

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-3xl font-bold text-gray-800">Chat Internal</h2>
        <p className="text-gray-600 mt-1">Komunikasi dengan tim dan dispatcher</p>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <Card title="Kontak" className="lg:col-span-1">
          <div className="space-y-2">
            {contacts.map(contact => (
              <button
                key={contact}
                onClick={() => setSelectedContact(contact)}
                className={`w-full p-4 rounded-xl text-left transition-all duration-200 ${
                  selectedContact === contact
                    ? 'bg-blue-50 border-2 border-blue-300'
                    : 'bg-gray-50 hover:bg-gray-100'
                }`}
              >
                <div className="flex items-center space-x-3">
                  <div className="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-emerald-500 flex items-center justify-center text-white font-bold">
                    {contact.charAt(0)}
                  </div>
                  <div className="flex-1">
                    <p className="font-semibold text-gray-800">{contact}</p>
                    <p className="text-xs text-gray-500">Online</p>
                  </div>
                </div>
              </button>
            ))}
          </div>
        </Card>

        <Card title={`Chat dengan ${selectedContact}`} className="lg:col-span-2">
          <div className="space-y-4">
            <div className="h-96 overflow-y-auto space-y-3 p-4 bg-gray-50 rounded-xl">
              {mockMessages.map(msg => (
                <div
                  key={msg.id}
                  className={`flex ${msg.isOwn ? 'justify-end' : 'justify-start'}`}
                >
                  <div
                    className={`max-w-xs p-3 rounded-2xl ${
                      msg.isOwn
                        ? 'bg-blue-600 text-white rounded-br-none'
                        : 'bg-white text-gray-800 rounded-bl-none shadow-md'
                    }`}
                  >
                    {!msg.isOwn && (
                      <p className="text-xs font-semibold mb-1 opacity-70">{msg.sender}</p>
                    )}
                    <p className="text-sm">{msg.text}</p>
                    <p className={`text-xs mt-1 ${msg.isOwn ? 'text-blue-200' : 'text-gray-500'}`}>
                      {msg.timestamp}
                    </p>
                  </div>
                </div>
              ))}
            </div>

            <div className="flex space-x-3">
              <input
                type="text"
                value={message}
                onChange={(e) => setMessage(e.target.value)}
                placeholder="Ketik pesan..."
                className="flex-1 px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <Button>Kirim</Button>
            </div>
          </div>
        </Card>
      </div>
    </div>
  );
};

const KnowledgeBasePage: React.FC = () => {
  const [searchTerm, setSearchTerm] = useState('');

  const filteredArticles = knowledgeBaseArticles.filter(article =>
    article.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
    article.category.toLowerCase().includes(searchTerm.toLowerCase())
  );

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-3xl font-bold text-gray-800">SOP & Panduan</h2>
        <p className="text-gray-600 mt-1">Knowledge base untuk membantu pekerjaan Anda</p>
      </div>

      <Card>
        <Input
          placeholder="Cari artikel atau panduan..."
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
        />
      </Card>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {filteredArticles.map(article => (
          <Card key={article.id} className="hover:shadow-xl transition-shadow cursor-pointer">
            <div className="space-y-3">
              <div className="flex items-start justify-between">
                <Badge variant="info">{article.category}</Badge>
                <span className="text-2xl">ğŸ“„</span>
              </div>
              <h3 className="font-bold text-gray-800 text-lg">{article.title}</h3>
              <div className="flex items-center justify-between pt-3 border-t border-gray-100">
                <span className="text-sm text-gray-500">{article.views} views</span>
                <button className="text-sm text-blue-600 font-medium hover:underline">
                  Baca Selengkapnya â†’
                </button>
              </div>
            </div>
          </Card>
        ))}
      </div>
    </div>
  );
};

const UsersPage: React.FC = () => {
  const [showAddUser, setShowAddUser] = useState(false);

  const mockUsers = [
    { id: '1', name: 'Ahmad Pratama', role: 'Technician', email: 'ahmad@fieldtech.com', status: 'active', lastLogin: '2024-01-15 08:15' },
    { id: '2', name: 'Siti Aminah', role: 'CS', email: 'siti@fieldtech.com', status: 'active', lastLogin: '2024-01-15 07:30' },
    { id: '3', name: 'Budi Hartono', role: 'Leader', email: 'budi@fieldtech.com', status: 'active', lastLogin: '2024-01-14 18:45' },
    { id: '4', name: 'Dewi Lestari', role: 'Warehouse', email: 'dewi@fieldtech.com', status: 'inactive', lastLogin: '2024-01-10 16:20' }
  ];

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-3xl font-bold text-gray-800">Manajemen User</h2>
          <p className="text-gray-600 mt-1">Kelola akses dan permission user sistem</p>
        </div>
        <Button onClick={() => setShowAddUser(!showAddUser)}>
          + Tambah User Baru
        </Button>
      </div>

      {showAddUser && (
        <Card title="Form Tambah User">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <Input label="Nama Lengkap" placeholder="Contoh: Ahmad Pratama" />
            <Input label="Email" type="email" placeholder="ahmad@fieldtech.com" />
            <Input label="No. Telepon" placeholder="081234567890" />
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Role</label>
              <select className="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option>Technician</option>
                <option>Customer Service</option>
                <option>Team Leader</option>
                <option>Dispatcher</option>
                <option>NOC</option>
                <option>Warehouse</option>
                <option>Admin</option>
              </select>
            </div>
            <Input label="Password" type="password" placeholder="Minimal 8 karakter" />
            <Input label="Konfirmasi Password" type="password" placeholder="Ulangi password" />
          </div>
          <div className="flex space-x-3 mt-6">
            <Button fullWidth>Simpan User</Button>
            <Button fullWidth variant="secondary" onClick={() => setShowAddUser(false)}>
              Batal
            </Button>
          </div>
        </Card>
      )}

      <Card title="Daftar User">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="border-b border-gray-200">
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Nama</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Role</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Email</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Last Login</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Aksi</th>
              </tr>
            </thead>
            <tbody>
              {mockUsers.map(user => (
                <tr key={user.id} className="border-b border-gray-100 hover:bg-gray-50">
                  <td className="py-3 px-4">
                    <div className="flex items-center space-x-3">
                      <div className="w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-emerald-500 flex items-center justify-center text-white text-xs font-bold">
                        {user.name.charAt(0)}
                      </div>
                      <span className="font-medium text-gray-800">{user.name}</span>
                    </div>
                  </td>
                  <td className="py-3 px-4">
                    <Badge variant="info">{user.role}</Badge>
                  </td>
                  <td className="py-3 px-4 text-gray-600">{user.email}</td>
                  <td className="py-3 px-4 text-gray-600 text-sm">{user.lastLogin}</td>
                  <td className="py-3 px-4">
                    <Badge variant={user.status === 'active' ? 'success' : 'default'}>
                      {user.status === 'active' ? 'Aktif' : 'Nonaktif'}
                    </Badge>
                  </td>
                  <td className="py-3 px-4">
                    <div className="flex space-x-2">
                      <button className="text-blue-600 hover:text-blue-800 text-sm">Edit</button>
                      <button className="text-red-600 hover:text-red-800 text-sm">Hapus</button>
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </Card>
    </div>
  );
};

const RolesPage: React.FC = () => {
  const mockRoles = [
    { id: '1', name: 'Technician', users: 15, permissions: ['Lihat Tugas', 'Update Status', 'Upload Dokumentasi'] },
    { id: '2', name: 'Customer Service', users: 8, permissions: ['Lihat Tiket', 'Buat Tiket', 'Update Tiket'] },
    { id: '3', name: 'Team Leader', users: 3, permissions: ['Assign Tugas', 'Approval BAI', 'Lihat KPI Tim'] },
    { id: '4', name: 'Admin', users: 2, permissions: ['Full Access', 'Manage Users', 'System Config'] }
  ];

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-3xl font-bold text-gray-800">Role & Permission</h2>
          <p className="text-gray-600 mt-1">Kelola hak akses untuk setiap role pengguna</p>
        </div>
        <Button>+ Tambah Role Baru</Button>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        {mockRoles.map(role => (
          <Card key={role.id}>
            <div className="space-y-4">
              <div className="flex items-start justify-between">
                <div>
                  <h3 className="text-xl font-bold text-gray-800">{role.name}</h3>
                  <p className="text-sm text-gray-600 mt-1">{role.users} users assigned</p>
                </div>
                <Badge variant="info">{role.users}</Badge>
              </div>

              <div className="pt-4 border-t border-gray-100">
                <p className="text-sm font-semibold text-gray-700 mb-3">Permissions:</p>
                <div className="space-y-2">
                  {role.permissions.map((perm, idx) => (
                    <div key={idx} className="flex items-center space-x-2 text-sm text-gray-600">
                      <span className="text-green-600">âœ“</span>
                      <span>{perm}</span>
                    </div>
                  ))}
                </div>
              </div>

              <div className="pt-4 border-t border-gray-100 flex space-x-2">
                <Button fullWidth variant="secondary" size="sm">Edit Permission</Button>
                <Button fullWidth variant="danger" size="sm">Hapus</Button>
              </div>
            </div>
          </Card>
        ))}
      </div>
    </div>
  );
};

const ApiSettingsPage: React.FC = () => {
  const mockApis = [
    { id: '1', name: 'CRM API', endpoint: 'https://api.crm.example.com', status: 'connected', lastSync: '2024-01-15 10:30' },
    { id: '2', name: 'Helpdesk API', endpoint: 'https://api.helpdesk.example.com', status: 'connected', lastSync: '2024-01-15 10:25' },
    { id: '3', name: 'NMS/GIS API', endpoint: 'https://api.nms.example.com', status: 'error', lastSync: '2024-01-15 08:15' },
    { id: '4', name: 'FreeRADIUS API', endpoint: 'https://api.radius.example.com', status: 'connected', lastSync: '2024-01-15 10:32' }
  ];

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-3xl font-bold text-gray-800">Pengaturan API</h2>
          <p className="text-gray-600 mt-1">Konfigurasi integrasi dengan sistem eksternal</p>
        </div>
        <Button>+ Tambah API Baru</Button>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        {mockApis.map(api => (
          <Card key={api.id}>
            <div className="space-y-4">
              <div className="flex items-start justify-between">
                <div>
                  <h3 className="text-lg font-bold text-gray-800">{api.name}</h3>
                  <p className="text-xs text-gray-500 mt-1">{api.endpoint}</p>
                </div>
                <Badge variant={api.status === 'connected' ? 'success' : 'danger'}>
                  {api.status === 'connected' ? 'Connected' : 'Error'}
                </Badge>
              </div>

              <div className="p-3 bg-gray-50 rounded-lg">
                <p className="text-xs text-gray-600">Last Sync: {api.lastSync}</p>
              </div>

              <div className="flex space-x-2">
                <Button fullWidth variant="secondary" size="sm">Test Connection</Button>
                <Button fullWidth size="sm">Configure</Button>
              </div>
            </div>
          </Card>
        ))}
      </div>

      <Card title="Webhook Configuration">
        <div className="space-y-4">
          <Input label="Webhook URL" placeholder="https://your-domain.com/webhook" />
          <Input label="Secret Key" type="password" placeholder="Enter webhook secret" />
          <div className="flex items-center space-x-4">
            <label className="flex items-center space-x-2">
              <input type="checkbox" className="w-4 h-4 rounded" />
              <span className="text-sm text-gray-700">Enable task completion webhook</span>
            </label>
            <label className="flex items-center space-x-2">
              <input type="checkbox" className="w-4 h-4 rounded" />
              <span className="text-sm text-gray-700">Enable inventory webhook</span>
            </label>
          </div>
          <Button>Save Webhook Settings</Button>
        </div>
      </Card>
    </div>
  );
};

const LogsPage: React.FC = () => {
  const mockLogs = [
    { id: '1', timestamp: '2024-01-15 10:35:22', user: 'Ahmad Pratama', action: 'Completed Task', details: 'Instalasi - Anton Wijaya', level: 'info' },
    { id: '2', timestamp: '2024-01-15 10:30:15', user: 'System', action: 'API Sync', details: 'CRM API sync completed', level: 'success' },
    { id: '3', timestamp: '2024-01-15 10:25:33', user: 'Siti Aminah', action: 'Created Ticket', details: 'Ticket #TK-2401-089', level: 'info' },
    { id: '4', timestamp: '2024-01-15 10:20:11', user: 'System', action: 'API Error', details: 'NMS/GIS connection timeout', level: 'error' },
    { id: '5', timestamp: '2024-01-15 10:15:44', user: 'Budi Hartono', action: 'Approved BAI', details: 'BAI #BAI-2401-045', level: 'info' }
  ];

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-3xl font-bold text-gray-800">System Logs</h2>
          <p className="text-gray-600 mt-1">Monitor aktivitas dan error sistem</p>
        </div>
        <Button variant="secondary">Export Logs</Button>
      </div>

      <Card>
        <div className="flex space-x-4 mb-6">
          <select className="px-4 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option>All Levels</option>
            <option>Info</option>
            <option>Success</option>
            <option>Warning</option>
            <option>Error</option>
          </select>
          <select className="px-4 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option>Last 24 Hours</option>
            <option>Last 7 Days</option>
            <option>Last 30 Days</option>
            <option>Custom Range</option>
          </select>
          <Input placeholder="Search logs..." />
        </div>

        <div className="space-y-3">
          {mockLogs.map(log => (
            <div key={log.id} className="p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors">
              <div className="flex items-start justify-between">
                <div className="flex-1">
                  <div className="flex items-center space-x-3 mb-2">
                    <Badge variant={
                      log.level === 'error' ? 'danger' :
                      log.level === 'success' ? 'success' :
                      'info'
                    }>
                      {log.level.toUpperCase()}
                    </Badge>
                    <span className="text-sm font-semibold text-gray-800">{log.action}</span>
                  </div>
                  <p className="text-sm text-gray-600 mb-1">{log.details}</p>
                  <div className="flex items-center space-x-4 text-xs text-gray-500">
                    <span>ğŸ‘¤ {log.user}</span>
                    <span>ğŸ• {log.timestamp}</span>
                  </div>
                </div>
                <button className="text-blue-600 hover:text-blue-800 text-sm">View Details</button>
              </div>
            </div>
          ))}
        </div>
      </Card>
    </div>
  );
};

const TicketsPage: React.FC = () => {
  const mockTickets = [
    { id: 'TK-001', customer: 'Budi Santoso', issue: 'Internet Mati Total', priority: 'urgent', status: 'open', created: '2024-01-15 09:30' },
    { id: 'TK-002', customer: 'Ani Wijaya', issue: 'Lambat Saat Streaming', priority: 'high', status: 'in-progress', created: '2024-01-15 08:15' },
    { id: 'TK-003', customer: 'Dedi Kurniawan', issue: 'Lampu ONT Merah', priority: 'normal', status: 'open', created: '2024-01-15 07:45' }
  ];

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-3xl font-bold text-gray-800">Tiket Pelanggan</h2>
          <p className="text-gray-600 mt-1">Kelola komplain dan request pelanggan</p>
        </div>
        <Button>+ Buat Tiket Baru</Button>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <Card className="bg-gradient-to-br from-red-500 to-red-600 text-white">
          <div className="space-y-2">
            <p className="text-red-100 text-sm font-medium">Open Tickets</p>
            <p className="text-4xl font-bold">12</p>
            <p className="text-red-100 text-xs">Perlu penanganan</p>
          </div>
        </Card>

        <Card className="bg-gradient-to-br from-yellow-500 to-yellow-600 text-white">
          <div className="space-y-2">
            <p className="text-yellow-100 text-sm font-medium">In Progress</p>
            <p className="text-4xl font-bold">8</p>
            <p className="text-yellow-100 text-xs">Sedang ditangani</p>
          </div>
        </Card>

        <Card className="bg-gradient-to-br from-green-500 to-green-600 text-white">
          <div className="space-y-2">
            <p className="text-green-100 text-sm font-medium">Resolved Today</p>
            <p className="text-4xl font-bold">15</p>
            <p className="text-green-100 text-xs">Selesai hari ini</p>
          </div>
        </Card>
      </div>

      <Card title="Daftar Tiket">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="border-b border-gray-200">
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Ticket ID</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Pelanggan</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Issue</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Priority</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Created</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">Aksi</th>
              </tr>
            </thead>
            <tbody>
              {mockTickets.map(ticket => (
                <tr key={ticket.id} className="border-b border-gray-100 hover:bg-gray-50">
                  <td className="py-3 px-4 font-semibold text-gray-800">{ticket.id}</td>
                  <td className="py-3 px-4 text-gray-600">{ticket.customer}</td>
                  <td className="py-3 px-4 text-gray-600">{ticket.issue}</td>
                  <td className="py-3 px-4">
                    <Badge variant={ticket.priority === 'urgent' ? 'danger' : ticket.priority === 'high' ? 'warning' : 'default'}>
                      {ticket.priority.toUpperCase()}
                    </Badge>
                  </td>
                  <td className="py-3 px-4">
                    <Badge variant={ticket.status === 'open' ? 'danger' : 'warning'}>
                      {ticket.status}
                    </Badge>
                  </td>
                  <td className="py-3 px-4 text-gray-600 text-sm">{ticket.created}</td>
                  <td className="py-3 px-4">
                    <Button size="sm">Assign</Button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </Card>
    </div>
  );
};

const NetworkMonitorPage: React.FC = () => {
  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-3xl font-bold text-gray-800">Network Monitoring</h2>
        <p className="text-gray-600 mt-1">Real-time monitoring jaringan fiber optik</p>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
        <Card className="bg-gradient-to-br from-green-500 to-green-600 text-white">
          <div className="space-y-2">
            <p className="text-green-100 text-sm font-medium">OLT Status</p>
            <p className="text-4xl font-bold">5/5</p>
            <p className="text-green-100 text-xs">All Online</p>
          </div>
        </Card>

        <Card className="bg-gradient-to-br from-blue-500 to-blue-600 text-white">
          <div className="space-y-2">
            <p className="text-blue-100 text-sm font-medium">Active ONTs</p>
            <p className="text-4xl font-bold">1,245</p>
            <p className="text-blue-100 text-xs">Connected</p>
          </div>
        </Card>

        <Card className="bg-gradient-to-br from-yellow-500 to-yellow-600 text-white">
          <div className="space-y-2">
            <p className="text-yellow-100 text-sm font-medium">Alarms</p>
            <p className="text-4xl font-bold">3</p>
            <p className="text-yellow-100 text-xs">Need attention</p>
          </div>
        </Card>

        <Card className="bg-gradient-to-br from-purple-500 to-purple-600 text-white">
          <div className="space-y-2">
            <p className="text-purple-100 text-sm font-medium">ODP Utilization</p>
            <p className="text-4xl font-bold">78%</p>
            <p className="text-purple-100 text-xs">Average</p>
          </div>
        </Card>
      </div>

      <Card title="Network Topology">
        <div className="h-96 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl flex items-center justify-center">
          <div className="text-center">
            <div className="text-6xl mb-4">ğŸŒ</div>
            <p className="text-gray-700 font-medium">Interactive Network Map</p>
            <p className="text-gray-600 text-sm">Visualisasi topologi jaringan real-time</p>
          </div>
        </div>
      </Card>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <Card title="Recent Alarms">
          <div className="space-y-3">
            <div className="p-3 bg-red-50 border border-red-200 rounded-lg">
              <div className="flex items-start justify-between">
                <div>
                  <p className="text-sm font-semibold text-red-900">OLT-03 High Temperature</p>
                  <p className="text-xs text-red-700 mt-1">Temperature: 78Â°C (Threshold: 75Â°C)</p>
                  <p className="text-xs text-red-600 mt-1">10:30:15</p>
                </div>
                <Badge variant="danger">CRITICAL</Badge>
              </div>
            </div>
            <div className="p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
              <div className="flex items-start justify-between">
                <div>
                  <p className="text-sm font-semibold text-yellow-900">ODP-B-05 Port Full</p>
                  <p className="text-xs text-yellow-700 mt-1">All 8 ports occupied</p>
                  <p className="text-xs text-yellow-600 mt-1">09:45:22</p>
                </div>
                <Badge variant="warning">WARNING</Badge>
              </div>
            </div>
          </div>
        </Card>

        <Card title="Performance Metrics">
          <div className="space-y-4">
            <div>
              <div className="flex justify-between text-sm mb-2">
                <span className="text-gray-700">Network Uptime</span>
                <span className="font-semibold text-gray-800">99.97%</span>
              </div>
              <div className="w-full bg-gray-200 rounded-full h-2">
                <div className="bg-green-600 h-2 rounded-full" style={{ width: '99.97%' }}></div>
              </div>
            </div>
            <div>
              <div className="flex justify-between text-sm mb-2">
                <span className="text-gray-700">Average Latency</span>
                <span className="font-semibold text-gray-800">12ms</span>
              </div>
              <div className="w-full bg-gray-200 rounded-full h-2">
                <div className="bg-blue-600 h-2 rounded-full" style={{ width: '75%' }}></div>
              </div>
            </div>
            <div>
              <div className="flex justify-between text-sm mb-2">
                <span className="text-gray-700">Bandwidth Usage</span>
                <span className="font-semibold text-gray-800">68%</span>
              </div>
              <div className="w-full bg-gray-200 rounded-full h-2">
                <div className="bg-purple-600 h-2 rounded-full" style={{ width: '68%' }}></div>
              </div>
            </div>
          </div>
        </Card>
      </div>
    </div>
  );
};

const LiveMapPage: React.FC = () => {
  const mockTechnicians = [
    { id: '1', name: 'Ahmad Pratama', status: 'on-task', location: 'Jakarta Selatan', currentTask: 'Instalasi - Anton Wijaya' },
    { id: '2', name: 'Budi Santoso', status: 'available', location: 'Jakarta Pusat', currentTask: null },
    { id: '3', name: 'Dewi Lestari', status: 'on-task', location: 'Jakarta Timur', currentTask: 'Perbaikan - Siti Rahayu' }
  ];

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-3xl font-bold text-gray-800">Live Technician Map</h2>
        <p className="text-gray-600 mt-1">Monitor posisi dan status teknisi real-time</p>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div className="lg:col-span-2">
          <Card title="Real-time Map">
            <div className="h-[600px] bg-gradient-to-br from-blue-50 to-emerald-50 rounded-xl flex items-center justify-center">
              <div className="text-center">
                <div className="text-6xl mb-4">ğŸ—ºï¸</div>
                <p className="text-gray-700 font-medium">Interactive Live Map</p>
                <p className="text-gray-600 text-sm">Showing real-time technician positions</p>
              </div>
            </div>
          </Card>
        </div>

        <div>
          <Card title="Technician Status">
            <div className="space-y-3">
              {mockTechnicians.map(tech => (
                <div key={tech.id} className="p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors">
                  <div className="flex items-center space-x-3 mb-2">
                    <div className="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-emerald-500 flex items-center justify-center text-white font-bold">
                      {tech.name.charAt(0)}
                    </div>
                    <div className="flex-1">
                      <p className="font-semibold text-gray-800">{tech.name}</p>
                      <p className="text-xs text-gray-500">ğŸ“ {tech.location}</p>
                    </div>
                  </div>
                  <div className="flex items-center justify-between">
                    <Badge variant={tech.status === 'on-task' ? 'warning' : 'success'}>
                      {tech.status === 'on-task' ? 'On Task' : 'Available'}
                    </Badge>
                  </div>
                  {tech.currentTask && (
                    <p className="text-xs text-gray-600 mt-2">Current: {tech.currentTask}</p>
                  )}
                </div>
              ))}
            </div>
          </Card>

          <Card title="Quick Actions" className="mt-6">
            <div className="space-y-2">
              <Button fullWidth>Assign New Task</Button>
              <Button fullWidth variant="secondary">Send Broadcast</Button>
              <Button fullWidth variant="secondary">View Reports</Button>
            </div>
          </Card>
        </div>
      </div>
    </div>
  );
};

// ===========================
// MAIN APP COMPONENT
// ===========================

export default function FieldTechApp() {
  const [currentRole, setCurrentRole] = useState<Role>('admin');
  const [currentPage, setCurrentPage] = useState('dashboard');
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [selectedTaskId, setSelectedTaskId] = useState<string | null>(null);

  const handleNavigate = (page: string) => {
    setCurrentPage(page);
    setSelectedTaskId(null);
    setSidebarOpen(false);
  };

  const handleSelectTask = (taskId: string) => {
    setSelectedTaskId(taskId);
    setCurrentPage('task-detail');
  };

  const handleBackToTasks = () => {
    setSelectedTaskId(null);
    setCurrentPage('tasks');
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50">
      <Sidebar
        isOpen={sidebarOpen}
        currentRole={currentRole}
        currentPage={currentPage}
        onNavigate={handleNavigate}
      />

      <div className="md:ml-64 min-h-screen">
        <Header
          onToggleSidebar={() => setSidebarOpen(!sidebarOpen)}
          currentRole={currentRole}
          userName="Ahmad Pratama"
        />

        <main className="p-4 md:p-8">
          <div className="mb-6 p-4 bg-white rounded-xl shadow-sm border border-gray-200">
            <div className="flex items-center space-x-4">
              <label className="text-sm font-medium text-gray-700">Demo Role:</label>
              <select
                value={currentRole}
                onChange={(e) => {
                  setCurrentRole(e.target.value as Role);
                  setCurrentPage('dashboard');
                }}
                className="px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                <option value="technician">Technician</option>
                <option value="cs">Customer Service</option>
                <option value="leader">Team Leader</option>
                <option value="dispatcher">Dispatcher</option>
                <option value="noc">NOC</option>
                <option value="warehouse">Warehouse</option>
                <option value="admin">Admin</option>
                <option value="management">Management</option>
              </select>
            </div>
          </div>

          {currentPage === 'dashboard' && (
            <DashboardPage currentRole={currentRole} onNavigate={handleNavigate} />
          )}
          {currentPage === 'tasks' && <TasksPage onSelectTask={handleSelectTask} />}
          {currentPage === 'task-detail' && selectedTaskId && (
            <TaskDetailPage taskId={selectedTaskId} onBack={handleBackToTasks} />
          )}
          {currentPage === 'inventory' && <InventoryPage />}
          {currentPage === 'chat' && <ChatPage />}
          {currentPage === 'knowledge' && <KnowledgeBasePage />}
          {currentPage === 'users' && <UsersPage />}
          {currentPage === 'roles' && <RolesPage />}
          {currentPage === 'api-settings' && <ApiSettingsPage />}
          {currentPage === 'logs' && <LogsPage />}
          {currentPage === 'tickets' && <TicketsPage />}
          {currentPage === 'network-monitor' && <NetworkMonitorPage />}
          {currentPage === 'live-map' && <LiveMapPage />}

          {!['dashboard', 'tasks', 'task-detail', 'inventory', 'chat', 'knowledge', 'users', 'roles', 'api-settings', 'logs', 'tickets', 'network-monitor', 'live-map'].includes(currentPage) && (
            <Card>
              <div className="text-center py-12">
                <div className="text-6xl mb-4">https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/7f4f6ec0-b792-4ea9-b9ef-dc7ddd096717.png</div>
                <h3 className="text-2xl font-bold text-gray-800 mb-2">
                  Halaman {currentPage.replace('-', ' ').toUpperCase()}
                </h3>
                <p className="text-gray-600">
                  Halaman ini sedang dalam pengembangan untuk role: <span className="font-semibold capitalize">{currentRole}</span>
                </p>
                <div className="mt-6">
                  <Button onClick={() => handleNavigate('dashboard')}>
                    Kembali ke Dashboard
                  </Button>
                </div>
              </div>
            </Card>
          )}
        </main>
      </div>
    </div>
  );
}
